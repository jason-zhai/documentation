AJS.toInit(function(e){var k=null,p,d,n,q,m,i=false,o,c=100;var h={key:function(){var s=e.Deferred();var t=e.trim(p.val());if(!t){s.reject(AJS.I18n.getText("space.key.empty"));return s}if(o){AJS.log("Aborting previous space key validation request.");o.abort()}o=e.getJSON(AJS.Confluence.getContextPath()+"/ajax/spaceavailable.action",{key:t}).done(function(u){if(!u.available&&u.message){s.reject(u.message)}else{s.resolve()}o=false});return s.promise()},name:function(){var s=e.Deferred();if(!e.trim(d.val())){s.reject(AJS.I18n.getText("space.name.empty"))}else{s.resolve()}return s.promise()}};function l(v){var u=v[0];if(u.setSelectionRange){var t=v.val().length;u.setSelectionRange(0,t)}else{if(u.createTextRange){var s=u.createTextRange();s.execCommand("SelectAll");s.select()}}}function g(s){if(s){n.removeAttr("disabled")}else{n.attr("disabled","disabled")}i=s}var r={};function b(u){g(false);var s=u.attr("name");var t=u.siblings(".error");r[s]=true;var v=h[s]();v.done(function(){delete r[s];t.text("").addClass("hidden")});v.fail(function(w){t.text(w).removeClass("hidden")});v.always(function(){g(e.isEmptyObject(r));u.attr("data-validated-value",u.val())});return v}function a(s){var w=s.find("#space-url-example"),t=AJS.Meta.get("base-url")+"/display/",u="<"+AJS.I18n.getText("space.create.form.key.placeholder")+">",y=function(A){A=A||u;var z=t+A;w.text(z)},v=false;g(false);y();p=s.find("input[name='key']").first();d=s.find("input[name='name']").first();q=p.parent().find(".error");m=d.parent().find(".error");p.generateFrom(d,{uppercase:false,maxNameLength:255,maxKeyLength:255,timeoutMS:c,validationCallback:function(){p.keyup()}});function x(){var A=e(this);var z=A.val();if(typeof A.data("originalVal")==="undefined"){A.data("originalVal","")}if(A.data("originalVal")===z){return}A.data("originalVal",z);b(A)}p.keyup(e.debounce(x,500));d.keyup(x);p.keyup(function(){y(p.val())});p.focus(function(){l(p)});s.find("#permission-private").change(function(){e("#permissions-group").toggleClass("locked")});s.submit(function(z){if(!v){z.preventDefault()}else{return}setTimeout(function(){var B=b(p);var A=b(d);e.when({},B,A).then(function(){if(i){v=true;s.submit()}})},c+1)})}function f(){var t=e(Confluence.Templates.CreateSpace.createSpaceForm({atlToken:e("#atlassian-token").prop("content")})),s=function(){t.submit()},u=function(){v.hide();d.val("");p.val("");q.text("").addClass("hidden");m.text("").addClass("hidden");g(false)},v=new AJS.ConfluenceDialog({width:600,height:400,id:"create-space-dialog",closeOnOutsideClick:true,onCancel:u,onSubmit:s});v.addHeader(AJS.I18n.getText("space.create.form.title"));v.addPanel("Panel 1",t);v.addSubmit(AJS.I18n.getText("space.create.form.submit.button"),s);v.addCancel(AJS.I18n.getText("cancel.name"),u);v.popup.element.find(".dialog-title").prepend(Confluence.Templates.CreateSpace.helpLink());n=v.popup.element.find(".button-panel-submit-button");a(t);v.gotoPage(0);v.gotoPanel(0);return v}AJS.bind("ready-for-create-space-form-init",function(t,s){n=s.find("input[type=submit]");a(s)});var j=e("#create-space-form:not(.noautobind)");if(j.length){AJS.trigger("ready-for-create-space-form-init",[j])}});