AJS.toInit(function(f){var g=840;var d=590;var e=71;Confluence.MovePageDialog=function(j){var o=AJS.Meta.get("page-title");j=f.extend({spaceKey:AJS.Meta.get("space-key"),spaceName:AJS.Meta.get("space-name"),pageTitle:o,parentPageTitle:AJS.Meta.get("parent-page-title"),title:AJS.I18n.getText("move.page.dialog.title.view",o),buttonName:AJS.I18n.getText("move.name"),openedPanel:AJS.I18n.getText("move.page.dialog.panel.location"),moveHandler:function(H){AJS.debug("No move handler defined. Closing dialog.");H.remove()},cancelHandler:function(H){H.remove();return false}},j);var i=j.spaceKey;var z=j.spaceName;var E=j.parentPageTitle;var m="";var p="";var n=function(H,I){m=H;p=I};var F=AJS.ConfluenceDialog({width:g,height:d,id:"move-page-dialog"});var D={spaceKey:i,spaceName:z,parentPageTitle:E,canMoveBetweenSpaces:AJS.Meta.get("page-id")==0||AJS.Meta.getBoolean("can-remove-page")};F.addHeader(j.title);F.addPanel(AJS.I18n.getText("move.page.dialog.panel.location"),Confluence.Templates.MovePage.movePageAdvancedPanel(D),"location-panel","location-panel-id");F.addPanel(AJS.I18n.getText("move.page.dialog.search.title"),Confluence.Templates.MovePage.movePageSearchPanel(D),"search-panel","search-panel-id");F.addPanel(AJS.I18n.getText("move.page.dialog.history.title"),Confluence.Templates.MovePage.historyPanel({pageTitle:AJS.Meta.get("page-title")}),"history-panel","history-panel-id");F.addPanel(AJS.I18n.getText("move.page.dialog.browse.title"),Confluence.Templates.MovePage.browsePanel({pageTitle:AJS.Meta.get("page-title")}),"browse-panel","browse-panel-id");F.get('#"'+AJS.I18n.getText("move.page.dialog.panel.location")+'"')[0].onselect=function(){f("#new-space-key").val(i);f("#new-space").val(z);f("#new-parent-page").val(E).select()};F.get('#"'+AJS.I18n.getText("move.page.dialog.search.title")+'"')[0].onselect=function(){f("#move-page-dialog .search-panel .search-results .selected").removeClass("selected");f("#move-page-dialog input.search-query").focus()};F.get('#"'+AJS.I18n.getText("move.page.dialog.history.title")+'"')[0].onselect=function(){f(".history-panel",A).movePageHistory(t)};F.get('#"'+AJS.I18n.getText("move.page.dialog.browse.title")+'"')[0].onselect=function(){AJS.debug("browse: "+[i,z,E].join());f(".browse-panel",A).movePageBrowse(t,i,z,E,s,j.pageTitle)};var y=function(I){I.nextPage();var H=f("#move-page-dialog");f(".ordering-panel",H).movePageOrdering(i,E,j.pageTitle,n)};var w=function(I){var K=f("#new-space:visible").val();var J=f("#new-space-key").val();var H=f("#new-parent-page:visible").val();if(K&&(K!=z||J!=i||H!=E)){Confluence.Dialogs.Breadcrumbs.defaultGetBreadcrumbs({spaceKey:J,pageTitle:H},function(){Confluence.PageLocation.set({spaceKey:J,spaceName:K,parentPageTitle:H});j.moveHandler(I,J,K,H,m,p,h)},function(L){f("#new-parent-breadcrumbs").html(Confluence.Templates.MovePage.breadcrumbError());if(L.status==404){t.error(AJS.I18n.getText("move.page.dialog.location.not.found"))}})}else{Confluence.PageLocation.set({spaceKey:i,spaceName:z,parentPageTitle:E});j.moveHandler(I,i,z,E,m,p,h)}};var G=function(H){if(f("#reorderCheck")[0].checked){y(H)}else{w(H)}};F.addButton(j.buttonName,G,"move-button");F.addCancel(AJS.I18n.getText("cancel.name"),j.cancelHandler);F.popup.element.find(".dialog-title").prepend(Confluence.Templates.MovePage.helpLink());F.addPage().addHeader(j.title).addPanel(AJS.I18n.getText("move.page.dialog.ordering.title"),Confluence.Templates.MovePage.orderingPagePanel(),"ordering-panel","ordering-panel-id").addLink(AJS.I18n.getText("move.page.dialog.back.button"),function(H){H.prevPage()},"dialog-back-link").addButton(AJS.I18n.getText("move.page.dialog.order.button"),w,"reorder-button").addCancel(AJS.I18n.getText("cancel.name"),j.cancelHandler);var B=F.get("button#"+j.buttonName)[0].item;f("button.move-button").before(Confluence.Templates.MovePage.reorderCheckbox());F.gotoPage(0);var A=f("#move-page-dialog");var x=A.find(".dialog-page-menu");var r=A.find(".dialog-page-body");var l=f(x[0]);var v=f(r[0]);v.height(l.height());v.width("75%");v.find(".dialog-panel-body").height(l.height()-e);var q=f(x[1]);var C=f(r[1]);q.width("0");C.width("100%");F.show();f(".location-panel .location-info",A).appendTo(f(".dialog-page-body:first",A));var k=new Confluence.Dialogs.Breadcrumbs.Controller(f("#new-parent-breadcrumbs"));function h(L){var K=f("#move-errors");if(K.length>0){K.remove()}K=f(Confluence.Templates.MovePage.errorMessage());var I=A.find(".browse-controls:visible");if(!I.length){I=A.find(".dialog-panel-body:visible")}I.append(K);if(!L||L.length==0){f(B).prop("disabled",false);return}var H=AJS.I18n.getText("errors.occurred");H+="<ul>\n<li>";if(f.isArray(L)){H+=L.join("</li>\n<li>")}else{H+=L}H+="</li>\n</ul>";var J=aui.message.warning({content:H});K.html(J);K.removeClass("hidden");F.gotoPage(0)}var t={moveButton:B,clearErrors:function(){h([])},error:h,select:function(J,I,H){AJS.debug("select: "+[J,I,H].join());i=J;z=I;E=H||"";f(B).prop("disabled",true);k.update({spaceKey:i,title:E},t)}};F.overrideLastTab();F.get('#"'+j.openedPanel+'"').select();var s=AJS.Meta.get("parent-page-title")||AJS.Meta.get("from-page-title");var u=new Confluence.Dialogs.Breadcrumbs.Controller(f("#current-parent-breadcrumbs"));u.update({spaceKey:AJS.Meta.get("space-key"),title:s},t);f(".location-panel",A).movePageLocation(t);f(".search-panel",A).movePageSearch(t);f(".history-panel",A).movePageHistory(t);f("#new-parent-page").select();if(j.hint){F.addHelpText(j.hint.template||j.hint.text,j.hint.arguments)}return A};var c=function(j,i,k,h){var l={pageId:AJS.params.pageId,spaceKey:j};if(k){l.position=h;l.targetId=k}else{if(i!=""){l.targetTitle=i;l.position="append"}else{l.position="topLevel"}}return l};function a(l,n,h,o,q,i,k){l=l.popup.element;l.addClass("waiting");f("button",l).prop("disabled",true);var j=f("<div class='throbber'></div>");l.append(j);var p=Raphael.spinner(j[0],100,"#666");function m(r){k(r);l.removeClass("waiting");p();f("button",l).prop("disabled",false)}AJS.safe.ajax({url:contextPath+"/pages/movepage.action",type:"GET",dataType:"json",data:new c(n,o,q,i),error:function(){m(AJS.I18n.getText("move.page.dialog.move.failed"))},success:function(r){var s=[].concat(r.validationErrors||[]).concat(r.actionErrors||[]).concat(r.errorMessage||[]);if(s.length>0){m(s);return}window.location.href=contextPath+r.page.url+(r.page.url.indexOf("?")>=0?"&":"?")+"moved=true"}})}AJS.bind("deferred.page-move.tools-menu",function(h){h.preventDefault();if(f("#move-page-dialog").length>0){f("#move-page-dialog, body > .shadow, body > .aui-blanket").remove()}new Confluence.MovePageDialog({moveHandler:a});return false});var b;AJS.bind("deferred.page-move.editor",function(h){h.preventDefault();if(f("#move-page-dialog").length>0){f("#move-page-dialog, body > .shadow, body > .aui-blanket").remove()}new Confluence.MovePageDialog({spaceName:b,spaceKey:f("#newSpaceKey").val(),pageTitle:f("#content-title").val(),parentPageTitle:f("#parentPageString").val(),buttonName:AJS.I18n.getText("move.name"),title:AJS.I18n.getText("move.page.dialog.title.edit"),moveHandler:function(m,j,n,o,l,k,i){b=n;f("#newSpaceKey").val(j);f("#parentPageString").val(o);if(o!=""){f("#position").val("append")}else{f("#position").val("topLevel")}if(l){f("#targetId").val(l);f("#position").val(k)}m.remove()}});return false})});